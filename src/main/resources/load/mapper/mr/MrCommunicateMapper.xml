<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="load.mapper.mr.MrCommunicateMapper">
  <resultMap id="BaseResultMap" type="load.entity.po.CommunicatePo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 14 22:10:49 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="username" jdbcType="VARCHAR" property="username" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="text" jdbcType="VARCHAR" property="text" />
    <result column="images" jdbcType="VARCHAR" property="images" />
    <result column="date" jdbcType="TIMESTAMP" property="date" />

    <collection property="replyList" ofType="load.entity.po.ReplyPo" select="selectReply" column="id"></collection>
  </resultMap>


  <resultMap id="myReplyResultMap" type="load.entity.po.ReplyPo">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="msgid" jdbcType="INTEGER" property="msgid" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="text" jdbcType="VARCHAR" property="text" />
    <result column="images" jdbcType="VARCHAR" property="images" />
    <result column="date" jdbcType="TIMESTAMP" property="date" />
    <result column="rea" jdbcType="VARCHAR" property="rea" />
    <result column="username" jdbcType="VARCHAR" property="username" />
    <collection property="childReplyPo" ofType="load.entity.po.ReplyPo" select="selectReply" column="id"></collection>

  </resultMap>

  <select id="getCommunicateAndReply" resultMap="BaseResultMap" >
    select     id, username, type, text, images, date
    from communicate
    <if test="id!=null and id !=''">
      id=#{id}
    </if>
  </select>


  <select id="selectReply" resultMap="myReplyResultMap">

    select id, msgid, type, text, images, date, rea, username
    from  replys
    where msgid=#{id}
    and type=2
  </select>

</mapper>